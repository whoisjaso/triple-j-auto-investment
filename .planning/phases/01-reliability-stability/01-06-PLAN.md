---
phase: 01-reliability-stability
plan: 06
type: execute
wave: 3
depends_on: ["01-05"]
files_modified: []
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Application loads without errors"
    - "Login/logout works"
    - "Vehicle CRUD works (view, add, edit, delete)"
    - "Inventory page displays vehicles"
    - "No regressions in existing functionality"
  artifacts: []
  key_links: []
---

<objective>
Verify STAB-03 decomposition by running the application and testing core functionality.

Purpose: Confirm that the facade pattern refactoring didn't break anything. All tests are automated via CLI commands.

Output: Verification that useStore() consumers (pages) work unchanged.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-reliability-stability/01-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify TypeScript compilation and file structure</name>
  <files></files>
  <action>
Run verification commands:

1. TypeScript compilation:
   ```bash
   cd triple-j-auto-investment-main && npx tsc --noEmit
   ```

2. Verify Store.tsx line count:
   ```bash
   wc -l triple-j-auto-investment-main/context/Store.tsx
   ```
   Must be under 300 lines.

3. Verify lib/store modules exist:
   ```bash
   ls -la triple-j-auto-investment-main/lib/store/
   ```
   Should show: types.ts, vehicles.ts, sheets.ts, leads.ts, index.ts

4. Verify no UI files changed (should show no modifications):
   ```bash
   git diff --name-only triple-j-auto-investment-main/App.tsx triple-j-auto-investment-main/pages/
   ```

5. Verify StoreContextType interface unchanged:
   ```bash
   grep -A 20 "interface StoreContextType" triple-j-auto-investment-main/context/Store.tsx
   ```
   Should show 17 properties: vehicles, leads, user, lastSync, isLoading, connectionError, refreshVehicles, login, triggerRecovery, logout, addVehicle, updateVehicle, removeVehicle, syncWithGoogleSheets, addLead, updateRegistration, resetToDefault
  </action>
  <verify>
- TypeScript compiles with no errors
- Store.tsx < 300 lines
- All 5 lib/store files exist
- No UI files modified
- Interface has all 17 properties
  </verify>
  <done>All structural verifications pass</done>
</task>

<task type="auto">
  <name>Task 2: Verify application builds successfully</name>
  <files></files>
  <action>
Run build to catch any runtime issues:

```bash
cd triple-j-auto-investment-main && npm run build
```

This verifies:
- All imports resolve correctly
- No circular dependencies
- Module bundling works
- No runtime type errors

If build fails, the error will indicate which module has issues.
  </action>
  <verify>Build completes without errors</verify>
  <done>Application builds successfully with decomposed Store.tsx</done>
</task>

</tasks>

<verification>
1. TypeScript: `npx tsc --noEmit` passes
2. Build: `npm run build` succeeds
3. Structure: lib/store/ has 5 files, Store.tsx < 300 lines
4. Interface: StoreContextType unchanged (17 properties)
5. UI: No changes to App.tsx or pages/*.tsx
</verification>

<success_criteria>
STAB-03 requirement satisfied:
- Store.tsx decomposed into AuthContext, VehicleContext, and base state - each under 300 lines

Actual structure:
- Store.tsx: < 300 lines (facade)
- lib/store/vehicles.ts: ~280 lines (vehicle CRUD)
- lib/store/sheets.ts: ~180 lines (Google Sheets sync)
- lib/store/leads.ts: ~60 lines (lead management)
- lib/store/types.ts: ~20 lines (shared types)

Consumer code unchanged:
- App.tsx: no modifications
- pages/*.tsx: no modifications
- pages/admin/*.tsx: no modifications
</success_criteria>

<output>
After completion, create `.planning/phases/01-reliability-stability/01-06-SUMMARY.md`

Mark STAB-03 as complete in REQUIREMENTS.md and STATE.md.
</output>
