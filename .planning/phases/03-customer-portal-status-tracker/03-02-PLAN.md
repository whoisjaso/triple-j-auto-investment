---
phase: 03-customer-portal-status-tracker
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/tracking/ProgressArc.tsx
  - components/tracking/ProgressRoad.tsx
  - components/tracking/VehicleIcon.tsx
  - components/tracking/StageInfo.tsx
  - components/tracking/LoadingCrest.tsx
  - components/tracking/ErrorState.tsx
  - components/tracking/index.ts
autonomous: true

must_haves:
  truths:
    - "Arc fills from 0 to current stage progress with smooth animation"
    - "Car drives along road to position matching current stage"
    - "Arc and road animations run simultaneously on page load"
    - "On resize, visualizations jump to final state (no replay)"
    - "Mobile shows vertical road, desktop shows horizontal"
    - "Vehicle icon matches body type (sedan, suv, truck)"
  artifacts:
    - path: "components/tracking/ProgressArc.tsx"
      provides: "Circular progress arc with logo center"
      min_lines: 60
    - path: "components/tracking/ProgressRoad.tsx"
      provides: "Road with animated car, start/finish flags"
      min_lines: 100
    - path: "components/tracking/VehicleIcon.tsx"
      provides: "SVG vehicle outlines (sedan, suv, truck)"
      min_lines: 40
    - path: "components/tracking/index.ts"
      provides: "Barrel exports for all tracking components"
      exports: ["ProgressArc", "ProgressRoad", "VehicleIcon", "StageInfo", "LoadingCrest", "ErrorState"]
  key_links:
    - from: "components/tracking/ProgressRoad.tsx"
      to: "components/tracking/VehicleIcon.tsx"
      via: "Component import"
      pattern: "import.*VehicleIcon"
    - from: "components/tracking/ProgressArc.tsx"
      to: "framer-motion"
      via: "Animation library"
      pattern: "from 'framer-motion'"
---

<objective>
Create reusable visualization components for the customer status tracker.

Purpose: Build the animated arc progress and road components per CONTEXT.md specifications. These components encapsulate animation logic and can be composed by the main tracker page.

Output: 6 components in `components/tracking/` directory with barrel export.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-customer-portal-status-tracker/03-CONTEXT.md
@.planning/phases/03-customer-portal-status-tracker/03-RESEARCH.md
@triple-j-auto-investment-main/components/SplashScreen.tsx
@triple-j-auto-investment-main/components/luxury/LuxurySplashScreen.tsx
@triple-j-auto-investment-main/tailwind.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create core visualization components</name>
  <files>
    components/tracking/ProgressArc.tsx
    components/tracking/ProgressRoad.tsx
    components/tracking/VehicleIcon.tsx
  </files>
  <action>
Create `components/tracking/` directory and add:

**VehicleIcon.tsx** - SVG vehicle outlines:
```typescript
import React from 'react';

interface VehicleIconProps {
  type?: string; // 'sedan', 'suv', 'truck'
  className?: string;
}

// Map body class names to icon types
function mapBodyTypeToIcon(bodyType?: string): 'sedan' | 'suv' | 'truck' {
  if (!bodyType) return 'sedan';
  const lower = bodyType.toLowerCase();
  if (lower.includes('suv') || lower.includes('sport utility') || lower.includes('crossover')) return 'suv';
  if (lower.includes('truck') || lower.includes('pickup')) return 'truck';
  return 'sedan';
}

export const VehicleIcon: React.FC<VehicleIconProps> = ({ type, className = '' }) => {
  const iconType = mapBodyTypeToIcon(type);

  const icons = {
    sedan: (/* sedan SVG path - 4-door silhouette */),
    suv: (/* SUV SVG path - higher profile */),
    truck: (/* truck SVG path - pickup bed */),
  };

  return icons[iconType];
};
```

Create clean, realistic outline SVGs (stroke only, no fill) sized at viewBox="0 0 100 40" for consistent aspect ratio. Use `currentColor` for stroke to inherit text color.

**ProgressArc.tsx** - Circular arc with logo:
```typescript
import React, { useEffect, useRef } from 'react';
import { motion, useAnimation } from 'framer-motion';

interface ProgressArcProps {
  progress: number; // 0-1 (e.g., 3/6 = 0.5)
  stageNumber: number; // 1-6
  totalStages: number; // 6
  onStageClick?: (stage: number) => void; // Mobile tap
}

export const ProgressArc: React.FC<ProgressArcProps> = ({
  progress,
  stageNumber,
  totalStages,
  onStageClick
}) => {
  const controls = useAnimation();
  const hasAnimated = useRef(false);

  // Animation duration per CONTEXT.md: 2.5-3 seconds
  const ANIMATION_DURATION = 2.5;

  useEffect(() => {
    if (hasAnimated.current) {
      // On resize/re-render: jump to final state
      controls.set({ strokeDashoffset: circumference * (1 - progress) });
    } else {
      // First render: animate
      controls.start({
        strokeDashoffset: circumference * (1 - progress),
        transition: { duration: ANIMATION_DURATION, ease: 'easeInOut' }
      });
      hasAnimated.current = true;
    }
  }, [progress]);

  const circumference = 2 * Math.PI * 80;

  return (
    <div className="relative w-48 h-48 md:w-56 md:h-56 mx-auto">
      <svg viewBox="0 0 200 200" className="w-full h-full">
        {/* Background arc - faded gold (20% opacity) */}
        <circle
          cx="100" cy="100" r="80"
          fill="none"
          stroke="rgba(212, 175, 55, 0.2)"
          strokeWidth="12"
        />
        {/* Progress arc - filled gold */}
        <motion.circle
          cx="100" cy="100" r="80"
          fill="none"
          stroke="#D4AF37"
          strokeWidth="12"
          strokeLinecap="round"
          strokeDasharray={circumference}
          initial={{ strokeDashoffset: circumference }}
          animate={controls}
          style={{ transformOrigin: 'center', transform: 'rotate(-90deg)' }}
        />
        {/* Stage markers with gold glow on current */}
        {Array.from({ length: totalStages }, (_, i) => {
          const angle = (i / totalStages) * 360 - 90;
          const x = 100 + 80 * Math.cos((angle * Math.PI) / 180);
          const y = 100 + 80 * Math.sin((angle * Math.PI) / 180);
          const isCurrent = i + 1 === stageNumber;
          const isComplete = i + 1 < stageNumber;

          return (
            <circle
              key={i}
              cx={x}
              cy={y}
              r="8"
              fill={isComplete ? '#D4AF37' : isCurrent ? '#D4AF37' : 'rgba(212, 175, 55, 0.3)'}
              className={isCurrent ? 'animate-pulse-glow' : ''}
              onClick={() => onStageClick?.(i + 1)}
              style={{ cursor: onStageClick ? 'pointer' : 'default' }}
            />
          );
        })}
      </svg>
      {/* Logo center */}
      <div className="absolute inset-0 flex items-center justify-center">
        <img
          src="/GoldTripleJLogo.png"
          alt="Triple J"
          className="w-20 h-20 md:w-24 md:h-24 object-contain"
        />
      </div>
      {/* Stage X of 6 text */}
      <p className="text-center text-white text-sm mt-2">
        Stage {stageNumber} of {totalStages}
      </p>
    </div>
  );
};
```

Add CSS animation for gold glow pulse in tailwind.config.js or as inline keyframes.

**ProgressRoad.tsx** - Road with car animation:
```typescript
import React, { useEffect, useRef } from 'react';
import { motion, useAnimation } from 'framer-motion';
import { VehicleIcon } from './VehicleIcon';

interface ProgressRoadProps {
  progress: number; // 0-1
  vehicleType?: string; // 'sedan', 'suv', 'truck'
}

export const ProgressRoad: React.FC<ProgressRoadProps> = ({ progress, vehicleType }) => {
  const carControls = useAnimation();
  const hasAnimated = useRef(false);
  const ANIMATION_DURATION = 2.5;

  useEffect(() => {
    if (hasAnimated.current) {
      carControls.set({ x: `${progress * 100}%` });
    } else {
      carControls.start({
        x: `${progress * 100}%`,
        transition: { duration: ANIMATION_DURATION, ease: 'easeInOut' }
      });
      hasAnimated.current = true;
    }
  }, [progress]);

  return (
    <div className="relative mt-8">
      {/* Desktop: horizontal road */}
      <div className="hidden md:block">
        <div className="relative h-16">
          {/* Road */}
          <div className="absolute inset-x-8 top-1/2 -translate-y-1/2 h-4 bg-gray-800 rounded">
            {/* Dashed center line */}
            <div className="absolute inset-x-0 top-1/2 -translate-y-1/2 h-0.5 border-t-2 border-dashed border-gray-600" />
          </div>
          {/* Start flag (green) */}
          <div className="absolute left-0 top-1/2 -translate-y-1/2">
            <Flag type="start" />
          </div>
          {/* Finish flag (checkered) */}
          <div className="absolute right-0 top-1/2 -translate-y-1/2">
            <Flag type="finish" />
          </div>
          {/* Car */}
          <motion.div
            className="absolute left-8 top-1/2 -translate-y-1/2 text-tj-gold"
            initial={{ x: '0%' }}
            animate={carControls}
            style={{ width: 'calc(100% - 64px)' }}
          >
            <div className="w-12">
              <VehicleIcon type={vehicleType} className="w-full h-auto" />
            </div>
          </motion.div>
        </div>
      </div>

      {/* Mobile: vertical road */}
      <div className="block md:hidden">
        {/* Similar structure but rotated 90 degrees */}
        {/* Road runs top-to-bottom, car drives downward */}
      </div>
    </div>
  );
};

// Start/Finish flag component
const Flag: React.FC<{ type: 'start' | 'finish' }> = ({ type }) => {
  if (type === 'start') {
    return (/* Green flag SVG */);
  }
  return (/* Checkered flag SVG */);
};
```

Key implementation notes:
- Use `hasAnimated` ref to prevent animation replay on resize
- Car position uses percentage-based transform for responsive sizing
- Vertical mobile layout with same animation logic but Y-axis movement
- Flags are simple SVG inline components
  </action>
  <verify>
Run `npm run build` - verify no TypeScript errors.
Check files exist: `ls -la components/tracking/`
  </verify>
  <done>
VehicleIcon renders 3 vehicle types. ProgressArc animates arc fill with stage markers. ProgressRoad shows car driving to progress position with responsive orientation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create supporting components and barrel export</name>
  <files>
    components/tracking/StageInfo.tsx
    components/tracking/LoadingCrest.tsx
    components/tracking/ErrorState.tsx
    components/tracking/index.ts
  </files>
  <action>
**StageInfo.tsx** - Current stage description panel:
```typescript
import React from 'react';
import { StageConfig, RegistrationStageKey, REGISTRATION_STAGES, getStageConfig } from '../../types';

interface StageInfoProps {
  currentStage: RegistrationStageKey;
  isRejected: boolean;
  milestones: {
    saleDate?: string;
    submissionDate?: string;
    approvalDate?: string;
    deliveryDate?: string;
  };
  rejectionNotes?: string;
}

const STAGE_DESCRIPTIONS: Record<RegistrationStageKey, string> = {
  sale_complete: 'Your vehicle purchase is complete! We\'re preparing the paperwork for your registration. You\'ll receive temporary plates to use until your permanent registration arrives.',
  documents_collected: 'We\'ve gathered all required documents including your title, insurance verification, and inspection certificate. Your registration packet is being prepared for DMV submission.',
  submitted_to_dmv: 'Your registration has been submitted to the Texas DMV through webDEALER. The state will review your application and process your permanent registration.',
  dmv_processing: 'The Texas DMV is currently reviewing your registration application. This typically takes 5-10 business days. We\'ll notify you as soon as it\'s approved.',
  sticker_ready: 'Great news! Your registration has been approved and your sticker is ready. Contact us to arrange pickup or delivery of your new registration sticker.',
  sticker_delivered: 'Your registration is complete! Your sticker has been delivered. Thank you for choosing Triple J Auto Investment.',
  rejected: 'Unfortunately, the DMV has flagged an issue with your registration. Our team is reviewing the notes and will contact you if any action is needed on your part.',
};

export const StageInfo: React.FC<StageInfoProps> = ({
  currentStage,
  isRejected,
  milestones,
  rejectionNotes
}) => {
  const stageConfig = getStageConfig(currentStage);
  const description = STAGE_DESCRIPTIONS[currentStage];

  // Format milestone date
  const formatDate = (dateString?: string) => {
    if (!dateString) return null;
    return new Date(dateString).toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric'
    });
  };

  return (
    <div className="mt-8 text-center max-w-lg mx-auto">
      {/* Rejected warning banner */}
      {isRejected && (
        <div className="mb-4 p-4 bg-red-900/30 border border-red-500/50 rounded">
          <p className="text-red-400 font-medium">Registration Requires Attention</p>
          {rejectionNotes && (
            <p className="text-red-300/80 text-sm mt-1">{rejectionNotes}</p>
          )}
        </div>
      )}

      {/* Current stage heading */}
      <h2 className="text-white text-xl font-display tracking-wide mb-2">
        {stageConfig?.label}
      </h2>

      {/* Description paragraph */}
      <p className="text-gray-400 text-sm leading-relaxed">
        {description}
      </p>

      {/* Expected duration for predictable stages */}
      {stageConfig?.expectedDuration && currentStage !== 'sticker_delivered' && (
        <p className="text-gray-500 text-xs mt-3">
          Expected: {stageConfig.expectedDuration}
        </p>
      )}

      {/* Completed stage dates */}
      <div className="mt-6 flex flex-wrap justify-center gap-4 text-xs text-gray-500">
        {milestones.saleDate && (
          <span>Sale: {formatDate(milestones.saleDate)}</span>
        )}
        {milestones.submissionDate && (
          <span>Submitted: {formatDate(milestones.submissionDate)}</span>
        )}
        {milestones.approvalDate && (
          <span>Approved: {formatDate(milestones.approvalDate)}</span>
        )}
        {milestones.deliveryDate && (
          <span>Delivered: {formatDate(milestones.deliveryDate)}</span>
        )}
      </div>
    </div>
  );
};
```

**LoadingCrest.tsx** - Animated loading state:
```typescript
import React from 'react';
import { motion } from 'framer-motion';

export const LoadingCrest: React.FC = () => (
  <div className="flex flex-col items-center justify-center min-h-[400px]">
    <motion.img
      src="/GoldTripleJLogo.png"
      alt="Loading..."
      className="w-24 h-24"
      animate={{
        scale: [1, 1.05, 1],
        filter: [
          'drop-shadow(0 0 15px rgba(212,175,55,0.4))',
          'drop-shadow(0 0 25px rgba(212,175,55,0.7))',
          'drop-shadow(0 0 15px rgba(212,175,55,0.4))'
        ]
      }}
      transition={{ duration: 2, repeat: Infinity, ease: 'easeInOut' }}
    />
    <p className="mt-4 text-gray-500 text-sm">Loading your registration...</p>
  </div>
);
```

**ErrorState.tsx** - Expired/invalid link states:
```typescript
import React from 'react';
import { AlertCircle, Clock, HelpCircle, Phone, Mail } from 'lucide-react';

interface ErrorStateProps {
  type: 'expired' | 'invalid' | 'not-found';
}

const ERROR_CONTENT = {
  expired: {
    icon: Clock,
    title: 'Link Expired',
    message: 'This tracking link has expired. Registration tracking links remain active for 30 days after your sticker is delivered.',
    showContact: true
  },
  invalid: {
    icon: AlertCircle,
    title: 'Invalid Link',
    message: 'This tracking link is not valid. Please check the link and try again, or contact us for assistance.',
    showContact: true
  },
  'not-found': {
    icon: HelpCircle,
    title: 'Registration Not Found',
    message: 'We couldn\'t find a registration matching this link. The order may have been removed or the link may be incorrect.',
    showContact: true
  }
};

export const ErrorState: React.FC<ErrorStateProps> = ({ type }) => {
  const content = ERROR_CONTENT[type];
  const Icon = content.icon;

  return (
    <div className="text-center py-16 max-w-md mx-auto">
      <Icon className="mx-auto text-amber-500 mb-4" size={48} />
      <h2 className="text-white text-xl font-display mb-2">{content.title}</h2>
      <p className="text-gray-400 mb-6">{content.message}</p>

      {content.showContact && (
        <div className="space-y-3 text-sm text-gray-500">
          <p>Questions? Contact Triple J Auto Investment:</p>
          <div className="flex flex-col sm:flex-row justify-center gap-4">
            <a
              href="tel:+17135550192"
              className="inline-flex items-center gap-2 text-tj-gold hover:text-white transition-colors"
            >
              <Phone size={14} />
              (713) 555-0192
            </a>
            <a
              href="mailto:registration@triplejautoinvestment.com"
              className="inline-flex items-center gap-2 text-tj-gold hover:text-white transition-colors"
            >
              <Mail size={14} />
              Email Us
            </a>
          </div>
        </div>
      )}
    </div>
  );
};
```

**index.ts** - Barrel export:
```typescript
export { ProgressArc } from './ProgressArc';
export { ProgressRoad } from './ProgressRoad';
export { VehicleIcon } from './VehicleIcon';
export { StageInfo } from './StageInfo';
export { LoadingCrest } from './LoadingCrest';
export { ErrorState } from './ErrorState';
```

Also update **tailwind.config.js** to add gold glow pulse animation:
```javascript
// In extend.keyframes:
'pulse-glow': {
  '0%, 100%': {
    filter: 'drop-shadow(0 0 4px rgba(212, 175, 55, 0.6))'
  },
  '50%': {
    filter: 'drop-shadow(0 0 12px rgba(212, 175, 55, 0.9))'
  }
}

// In extend.animation:
'pulse-glow': 'pulse-glow 2s ease-in-out infinite'
```
  </action>
  <verify>
Run `npm run build` - verify no TypeScript errors.
Verify exports: `grep "export" components/tracking/index.ts`
  </verify>
  <done>
StageInfo displays descriptions and milestones. LoadingCrest shows pulsing logo. ErrorState handles 3 error types with contact info. Barrel export exposes all 6 components.
  </done>
</task>

</tasks>

<verification>
- [ ] `components/tracking/` directory exists with 7 files (6 components + index.ts)
- [ ] VehicleIcon renders sedan, suv, truck SVGs based on type prop
- [ ] ProgressArc animates on first render, jumps on subsequent renders
- [ ] ProgressRoad shows horizontal on desktop, vertical on mobile
- [ ] StageInfo displays stage descriptions with milestone dates
- [ ] LoadingCrest shows pulsing logo animation
- [ ] ErrorState handles expired, invalid, not-found types
- [ ] tailwind.config.js has pulse-glow animation
- [ ] `npm run build` passes
</verification>

<success_criteria>
1. All 6 visualization components exist and export correctly
2. Animations play once on load, skip on resize (per CONTEXT.md)
3. Mobile vertical road layout works via Tailwind responsive classes
4. Gold color theme matches brand (#D4AF37)
5. Build passes with all components
</success_criteria>

<output>
After completion, create `.planning/phases/03-customer-portal-status-tracker/03-02-SUMMARY.md`
</output>
